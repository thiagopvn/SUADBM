"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[960],{32401:(e,t,a)=>{a.d(t,{J:()=>c});var r=a(80314),s=a(81115);class o extends Error{constructor(e,t){super(e),this.cause=t,this.name="FirebaseServiceError"}}class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}async getAllCreditos(){try{let e=(0,s.KR)(r.O,"creditos"),t=await (0,s.Jt)(e),a=t.exists()?t.val():{};return Object.values(a).forEach(e=>{e&&!e.eixos&&(e.eixos=[])}),a}catch(e){throw new o("Failed to fetch credits",e)}}async getCreditoById(e){try{let t=(0,s.KR)(r.O,"creditos/".concat(e)),a=await (0,s.Jt)(t);return a.exists()?a.val():null}catch(t){throw new o("Failed to fetch credit ".concat(e),t)}}async getCreditosWithCalculations(){try{let e=await this.getAllCreditos(),t=await this.getAllDespesas(),a=[];return Object.entries(e).forEach(e=>{let[r,s]=e,o=s.id,i=0,c=0;Object.values(t).forEach(e=>{(e.fontesDeRecurso||[]).forEach(e=>{e.creditoId===o&&(e.notaEmpenho&&e.dataEmpenho&&(i+=e.valorUtilizado),e.ordemBancaria&&e.dataPagamento&&(c+=e.valorUtilizado))})});let n=s.valorGlobal-(c+i);a.push({...s,eixos:s.eixos||[],valorEmpenhado:i,valorPago:c,saldoDisponivel:n})}),a}catch(e){throw new o("Failed to fetch credits with calculations",e)}}async createCredito(e){try{let t=(0,s.KR)(r.O,"creditos"),a=(0,s.VC)(t),o=a.key,i={...e,id:o};return await (0,s.hZ)(a,i),await this.gerarPrimeiraObrigacao(o,e.dataLancamento),o}catch(e){throw new o("Failed to create credit",e)}}async updateCredito(e,t){try{let a=(0,s.KR)(r.O,"creditos/".concat(e));await (0,s.yo)(a,t)}catch(t){throw new o("Failed to update credit ".concat(e),t)}}async deleteCredito(e){try{let t=await this.getAllDespesas();if(Object.values(t).filter(t=>t.fontesDeRecurso.some(t=>t.creditoId===e)).length>0)throw new o("Cannot delete credit: expenses are using this credit");let a=(0,s.KR)(r.O,"creditos/".concat(e));for(let t of(await (0,s.TF)(a),await this.getAllPrestacoesByCredito(e)))await this.deletePrestacaoContas(t.id)}catch(t){throw new o("Failed to delete credit ".concat(e),t)}}async getAllDespesas(){try{let e=(0,s.KR)(r.O,"despesas"),t=await (0,s.Jt)(e),a=t.exists()?t.val():{};return Object.values(a).forEach(e=>{e&&!e.fontesDeRecurso&&(e.fontesDeRecurso=[])}),a}catch(e){throw new o("Failed to fetch expenses",e)}}async getDespesaById(e){try{let t=(0,s.KR)(r.O,"despesas/".concat(e)),a=await (0,s.Jt)(t);return a.exists()?a.val():null}catch(t){throw new o("Failed to fetch expense ".concat(e),t)}}async createDespesa(e){try{await this.validarSaldoCreditos(e.fontesDeRecurso);let t=(0,s.KR)(r.O,"despesas"),a=(0,s.VC)(t),o=a.key,i=e.fontesDeRecurso.map(e=>({...e,id:e.id||(0,s.VC)((0,s.KR)(r.O)).key})),c={...e,id:o,fontesDeRecurso:i};return await (0,s.hZ)(a,c),o}catch(e){throw new o("Failed to create expense",e)}}async updateDespesa(e,t){try{t.fontesDeRecurso&&(await this.validarSaldoCreditos(t.fontesDeRecurso,e),t.fontesDeRecurso=t.fontesDeRecurso.map(e=>({...e,id:e.id||(0,s.VC)((0,s.KR)(r.O)).key})));let a=(0,s.KR)(r.O,"despesas/".concat(e));await (0,s.yo)(a,t)}catch(t){throw new o("Failed to update expense ".concat(e),t)}}async deleteDespesa(e){try{let t=(0,s.KR)(r.O,"despesas/".concat(e));await (0,s.TF)(t)}catch(t){throw new o("Failed to delete expense ".concat(e),t)}}async validarSaldoCreditos(e,t){let a=await this.getCreditosWithCalculations(),r=await this.getAllDespesas();for(let s of e){let e=a.find(e=>e.id===s.creditoId);if(!e)throw new o("Credit ".concat(s.creditoId," not found"));let i=e.saldoDisponivel;if(t){let e=r[t];if(e){let t=e.fontesDeRecurso.find(e=>e.creditoId===s.creditoId);t&&(i+=t.valorUtilizado)}}if(s.valorUtilizado>i)throw new o("Insufficient balance in credit ".concat(e.creditoCodigo,". Available: ").concat(i,", Required: ").concat(s.valorUtilizado))}}async getDashboardData(e){try{let t=await this.getAllCreditos(),a=await this.getAllDespesas(),r=0,s=0,o=0,i=0,c=Object.values(t).filter(t=>!e||t.anoExercicio===e);i=c.length,r=c.reduce((e,t)=>e+t.valorGlobal,0),Object.values(a).forEach(e=>{e.fontesDeRecurso.forEach(e=>{c.find(t=>t.id===e.creditoId)&&(e.notaEmpenho&&e.dataEmpenho&&(s+=e.valorUtilizado),e.ordemBancaria&&e.dataPagamento&&(o+=e.valorUtilizado))})});let n=r-(o+s);return{valorGlobalConsolidado:r,valorEmpenhado:s,valorLiquidadoPago:o,saldoDisponivel:n,totalCreditos:i}}catch(e){throw new o("Failed to calculate dashboard data",e)}}async getDespesasWithCreditInfo(){try{let e=await this.getAllDespesas(),t=await this.getAllCreditos();return Object.values(e).map(e=>({...e,creditosAssociados:e.fontesDeRecurso.map(e=>{var a;return{creditoId:e.creditoId,creditoCodigo:(null==(a=t[e.creditoId])?void 0:a.creditoCodigo)||"N/A",valorUtilizado:e.valorUtilizado}})}))}catch(e){throw new o("Failed to fetch expenses with credit info",e)}}async getMetasAcoes(){try{let e=(0,s.KR)(r.O,"metasAcoes"),t=await (0,s.Jt)(e);return t.exists()?t.val():{}}catch(e){throw new o("Failed to fetch metas and actions",e)}}async createMetaAcao(e,t){try{let a=(0,s.KR)(r.O,"metasAcoes/".concat(e));await (0,s.hZ)(a,{descricao:t})}catch(t){throw new o("Failed to create meta/action ".concat(e),t)}}async initializeWithMockData(e){try{let t=(0,s.KR)(r.O);await (0,s.hZ)(t,e)}catch(e){throw new o("Failed to initialize with mock data",e)}}async exportData(){try{let e=(0,s.KR)(r.O),t=await (0,s.Jt)(e);return t.exists()?t.val():{creditos:{},despesas:{},metasAcoes:{},fechamentosAnuais:{}}}catch(e){throw new o("Failed to export data",e)}}async checkConnection(){try{let e=(0,s.KR)(r.O,".info/connected"),t=await (0,s.Jt)(e);return t.exists()&&!0===t.val()}catch(e){return!1}}async getAllPrestacoesByCredito(e){try{let t=(0,s.KR)(r.O,"prestacoesContas"),a=await (0,s.Jt)(t);if(!a.exists())return[];let o=a.val(),i=[];return Object.entries(o).forEach(t=>{let[a,r]=t;r.creditoId===e&&i.push({...r,id:a,despesasVinculadas:r.despesasVinculadas||[]})}),i.sort((e,t)=>e.prazoFinal.localeCompare(t.prazoFinal))}catch(t){throw new o("Failed to fetch presta\xe7\xf5es for credit ".concat(e),t)}}async createPrestacaoContas(e){try{let t=(0,s.KR)(r.O,"prestacoesContas"),a=(0,s.VC)(t),o=a.key,i={...e,id:o};return await (0,s.hZ)(a,i),o}catch(e){throw new o("Failed to create presta\xe7\xe3o de contas",e)}}async updatePrestacaoContas(e,t){try{let a=(0,s.KR)(r.O,"prestacoesContas/".concat(e));if(await (0,s.yo)(a,t),"Entregue"===t.status){let t=await (0,s.Jt)(a);if(t.exists()){let a={...t.val(),id:e};await this.gerarProximaObrigacao(a)}}}catch(t){throw new o("Failed to update presta\xe7\xe3o ".concat(e),t)}}async deletePrestacaoContas(e){try{let t=(0,s.KR)(r.O,"prestacoesContas/".concat(e));await (0,s.TF)(t)}catch(t){throw new o("Failed to delete presta\xe7\xe3o ".concat(e),t)}}async gerarPrimeiraObrigacao(e,t){try{if(!await this.getCreditoById(e))throw Error("Cr\xe9dito n\xe3o encontrado");let a=this.calcularProximoPrazo(t);await this.createPrestacaoContas({creditoId:e,ano:new Date(t).getFullYear(),periodoLabel:"1\xaa Presta\xe7\xe3o (at\xe9 ".concat(this.formatarData(a),")"),prazoFinal:a,status:"Pendente",despesasVinculadas:[]})}catch(e){throw new o("Failed to generate first obligation",e)}}async gerarProximaObrigacao(e){try{if(!await this.getCreditoById(e.creditoId))return;let t=(await this.getAllPrestacoesByCredito(e.creditoId)).length+1,a=this.calcularProximoPrazo(e.prazoFinal);await this.createPrestacaoContas({creditoId:e.creditoId,ano:new Date(a).getFullYear(),periodoLabel:"".concat(t,"\xaa Presta\xe7\xe3o (at\xe9 ").concat(this.formatarData(a),")"),prazoFinal:a,status:"Pendente",despesasVinculadas:[]})}catch(e){throw new o("Failed to generate next obligation",e)}}calcularProximoPrazo(e){let t=new Date(e);return t.setMonth(t.getMonth()+4),t.toISOString().split("T")[0]}formatarData(e){let[t,a,r]=e.split("-");return"".concat(r,"/").concat(a,"/").concat(t)}async searchDespesasByObjeto(e){try{let t=await this.getAllDespesas();return Object.values(t).filter(t=>t.objeto.toLowerCase().includes(e.toLowerCase()))}catch(e){throw new o("Failed to search expenses",e)}}async searchCreditosByCodigo(e){try{let t=await this.getAllCreditos();return Object.values(t).filter(t=>t.creditoCodigo.toLowerCase().includes(e.toLowerCase()))}catch(e){throw new o("Failed to search credits",e)}}async getDespesaDetailsWithCredits(e){try{let t=await this.getDespesaById(e);if(!t)return null;let a=await this.getAllCreditos(),r=t.fontesDeRecurso.map(e=>({fonte:e,credito:a[e.creditoId]})).filter(e=>e.credito);return{...t,fontesComCreditos:r}}catch(e){throw new o("Failed to get expense details",e)}}async getDespesasByCreditoId(e){try{let t=await this.getAllDespesas(),a=[];return Object.values(t).forEach(t=>{let r=t.fontesDeRecurso.find(t=>t.creditoId===e);r&&a.push({despesa:t,participacao:r})}),a}catch(e){throw new o("Failed to get expenses by credit",e)}}constructor(){}}let c=i.getInstance()},33667:(e,t,a)=>{a.d(t,{A:()=>i});var r=a(12115),s=a(80314),o=a(16203);function i(){let[e,t]=(0,r.useState)(null),[a,i]=(0,r.useState)(!0),[c,n]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,o.hg)(s.j,e=>{t(e),i(!1)},e=>{n(e.message),i(!1)});return()=>e()},[]),{user:e,loading:a,error:c,logout:(0,r.useCallback)(async()=>{try{n(null),await (0,o.CI)(s.j),window.location.href="/login"}catch(e){throw n(e instanceof Error?e.message:"Failed to logout"),e}},[]),clearError:(0,r.useCallback)(()=>{n(null)},[]),isAuthenticated:!!e}}},53999:(e,t,a)=>{a.d(t,{Yq:()=>c,cn:()=>o,qY:()=>n,vv:()=>i});var r=a(52596),s=a(39688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}function i(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}function c(e){return e?new Date(e).toLocaleDateString("pt-BR"):"-"}function n(e){return({Planejado:"bg-gray-100 text-gray-800",Empenhado:"bg-blue-100 text-blue-800",Liquidado:"bg-yellow-100 text-yellow-800",Pago:"bg-green-100 text-green-800",Cancelado:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800"}},69758:(e,t,a)=>{a.d(t,{F:()=>y});var r=a(95155),s=a(6874),o=a.n(s),i=a(35695),c=a(53999),n=a(33667),l=a(57340),d=a(55868),h=a(47924),u=a(72713),w=a(381),f=a(34835);let p=[{href:"/",label:"Dashboard",icon:l.A},{href:"/creditos",label:"Cr\xe9ditos",icon:d.A},{href:"/rastreamento",label:"Rastreamento",icon:h.A},{href:"/relatorios",label:"Relat\xf3rios",icon:u.A},{href:"/configuracoes",label:"Configura\xe7\xf5es",icon:w.A}];function y(){let e=(0,i.usePathname)(),{logout:t,loading:a}=(0,n.A)(),s=async()=>{if(!a)try{await t()}catch(e){console.error("Logout failed:",e)}};return(0,r.jsx)("nav",{className:"bg-white border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"SICOF - CBMERJ"})}),(0,r.jsx)("div",{className:"hidden sm:ml-8 sm:flex sm:space-x-8",children:p.map(t=>{let a=t.icon,s=e===t.href||"/"!==t.href&&e.startsWith(t.href);return(0,r.jsxs)(o(),{href:t.href,className:(0,c.cn)("inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",s?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:[(0,r.jsx)(a,{className:"w-4 h-4 mr-2"}),t.label]},t.href)})})]}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsxs)("button",{onClick:s,disabled:a,className:"flex items-center text-gray-500 hover:text-gray-700 disabled:opacity-50",children:[(0,r.jsx)(f.A,{className:"w-4 h-4 mr-2"}),a?"Saindo...":"Sair"]})})]})})})}},80314:(e,t,a)=>{a.d(t,{O:()=>n,j:()=>l});var r=a(23915),s=a(81115),o=a(16203),i=a(86864);let c=(0,r.Wp)({apiKey:"AIzaSyDhLLzcqgM26plgH7eL5mWms3EDeJqHpMY",authDomain:"suad-44036.firebaseapp.com",databaseURL:"https://suad-44036-default-rtdb.firebaseio.com",projectId:"suad-44036",storageBucket:"suad-44036.firebasestorage.app",messagingSenderId:"33344546339",appId:"1:33344546339:web:4de36f2ebaa4e4ea11f396",measurementId:"G-SNDT989PZE"}),n=(0,s.C3)(c),l=(0,o.xI)(c);(0,i.TT)().then(e=>{e&&(0,i.P5)(c)})}}]);