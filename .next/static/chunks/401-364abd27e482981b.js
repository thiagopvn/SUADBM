"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[401],{32401:(t,e,a)=>{a.d(e,{J:()=>c});var o=a(80314),r=a(81115);class s extends Error{constructor(t,e){super(t),this.cause=e,this.name="FirebaseServiceError"}}class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}async getAllCreditos(){try{let t=(0,r.KR)(o.O,"creditos"),e=await (0,r.Jt)(t);return e.exists()?e.val():{}}catch(t){throw new s("Failed to fetch credits",t)}}async getCreditoById(t){try{let e=(0,r.KR)(o.O,"creditos/".concat(t)),a=await (0,r.Jt)(e);return a.exists()?a.val():null}catch(e){throw new s("Failed to fetch credit ".concat(t),e)}}async getCreditosWithCalculations(){try{let t=await this.getAllCreditos(),e=await this.getAllDespesas(),a=[];return Object.entries(t).forEach(t=>{let[o,r]=t,s=r.id,i=0,c=0;Object.values(e).forEach(t=>{t.fontesDeRecurso.forEach(t=>{t.creditoId===s&&(t.notaEmpenho&&t.dataEmpenho&&(i+=t.valorUtilizado),t.ordemBancaria&&t.dataPagamento&&(c+=t.valorUtilizado))})});let n=r.valorGlobal-(c+i);a.push({...r,valorEmpenhado:i,valorPago:c,saldoDisponivel:n})}),a}catch(t){throw new s("Failed to fetch credits with calculations",t)}}async createCredito(t){try{let e=(0,r.KR)(o.O,"creditos"),a=(0,r.VC)(e),s=a.key,i={...t,id:s};return await (0,r.hZ)(a,i),await this.gerarPrimeiraObrigacao(s,t.dataLancamento),s}catch(t){throw new s("Failed to create credit",t)}}async updateCredito(t,e){try{let a=(0,r.KR)(o.O,"creditos/".concat(t));await (0,r.yo)(a,e)}catch(e){throw new s("Failed to update credit ".concat(t),e)}}async deleteCredito(t){try{let e=await this.getAllDespesas();if(Object.values(e).filter(e=>e.fontesDeRecurso.some(e=>e.creditoId===t)).length>0)throw new s("Cannot delete credit: expenses are using this credit");let a=(0,r.KR)(o.O,"creditos/".concat(t));for(let e of(await (0,r.TF)(a),await this.getAllPrestacoesByCredito(t)))await this.deletePrestacaoContas(e.id)}catch(e){throw new s("Failed to delete credit ".concat(t),e)}}async getAllDespesas(){try{let t=(0,r.KR)(o.O,"despesas"),e=await (0,r.Jt)(t);return e.exists()?e.val():{}}catch(t){throw new s("Failed to fetch expenses",t)}}async getDespesaById(t){try{let e=(0,r.KR)(o.O,"despesas/".concat(t)),a=await (0,r.Jt)(e);return a.exists()?a.val():null}catch(e){throw new s("Failed to fetch expense ".concat(t),e)}}async createDespesa(t){try{await this.validarSaldoCreditos(t.fontesDeRecurso);let e=(0,r.KR)(o.O,"despesas"),a=(0,r.VC)(e),s=a.key,i=t.fontesDeRecurso.map(t=>({...t,id:t.id||(0,r.VC)((0,r.KR)(o.O)).key})),c={...t,id:s,fontesDeRecurso:i};return await (0,r.hZ)(a,c),s}catch(t){throw new s("Failed to create expense",t)}}async updateDespesa(t,e){try{e.fontesDeRecurso&&(await this.validarSaldoCreditos(e.fontesDeRecurso,t),e.fontesDeRecurso=e.fontesDeRecurso.map(t=>({...t,id:t.id||(0,r.VC)((0,r.KR)(o.O)).key})));let a=(0,r.KR)(o.O,"despesas/".concat(t));await (0,r.yo)(a,e)}catch(e){throw new s("Failed to update expense ".concat(t),e)}}async deleteDespesa(t){try{let e=(0,r.KR)(o.O,"despesas/".concat(t));await (0,r.TF)(e)}catch(e){throw new s("Failed to delete expense ".concat(t),e)}}async validarSaldoCreditos(t,e){let a=await this.getCreditosWithCalculations(),o=await this.getAllDespesas();for(let r of t){let t=a.find(t=>t.id===r.creditoId);if(!t)throw new s("Credit ".concat(r.creditoId," not found"));let i=t.saldoDisponivel;if(e){let t=o[e];if(t){let e=t.fontesDeRecurso.find(t=>t.creditoId===r.creditoId);e&&(i+=e.valorUtilizado)}}if(r.valorUtilizado>i)throw new s("Insufficient balance in credit ".concat(t.creditoCodigo,". Available: ").concat(i,", Required: ").concat(r.valorUtilizado))}}async getDashboardData(t){try{let e=await this.getAllCreditos(),a=await this.getAllDespesas(),o=0,r=0,s=0,i=0,c=Object.values(e).filter(e=>!t||e.anoExercicio===t);i=c.length,o=c.reduce((t,e)=>t+e.valorGlobal,0),Object.values(a).forEach(t=>{t.fontesDeRecurso.forEach(t=>{c.find(e=>e.id===t.creditoId)&&(t.notaEmpenho&&t.dataEmpenho&&(r+=t.valorUtilizado),t.ordemBancaria&&t.dataPagamento&&(s+=t.valorUtilizado))})});let n=o-(s+r);return{valorGlobalConsolidado:o,valorEmpenhado:r,valorLiquidadoPago:s,saldoDisponivel:n,totalCreditos:i}}catch(t){throw new s("Failed to calculate dashboard data",t)}}async getDespesasWithCreditInfo(){try{let t=await this.getAllDespesas(),e=await this.getAllCreditos();return Object.values(t).map(t=>({...t,creditosAssociados:t.fontesDeRecurso.map(t=>{var a;return{creditoId:t.creditoId,creditoCodigo:(null==(a=e[t.creditoId])?void 0:a.creditoCodigo)||"N/A",valorUtilizado:t.valorUtilizado}})}))}catch(t){throw new s("Failed to fetch expenses with credit info",t)}}async getMetasAcoes(){try{let t=(0,r.KR)(o.O,"metasAcoes"),e=await (0,r.Jt)(t);return e.exists()?e.val():{}}catch(t){throw new s("Failed to fetch metas and actions",t)}}async createMetaAcao(t,e){try{let a=(0,r.KR)(o.O,"metasAcoes/".concat(t));await (0,r.hZ)(a,{descricao:e})}catch(e){throw new s("Failed to create meta/action ".concat(t),e)}}async initializeWithMockData(t){try{let e=(0,r.KR)(o.O);await (0,r.hZ)(e,t)}catch(t){throw new s("Failed to initialize with mock data",t)}}async exportData(){try{let t=(0,r.KR)(o.O),e=await (0,r.Jt)(t);return e.exists()?e.val():{creditos:{},despesas:{},metasAcoes:{},fechamentosAnuais:{}}}catch(t){throw new s("Failed to export data",t)}}async checkConnection(){try{let t=(0,r.KR)(o.O,".info/connected"),e=await (0,r.Jt)(t);return e.exists()&&!0===e.val()}catch(t){return!1}}async getAllPrestacoesByCredito(t){try{let e=(0,r.KR)(o.O,"prestacoesContas"),a=await (0,r.Jt)(e);if(!a.exists())return[];let s=a.val(),i=[];return Object.entries(s).forEach(e=>{let[a,o]=e;o.creditoId===t&&i.push({...o,id:a})}),i.sort((t,e)=>t.prazoFinal.localeCompare(e.prazoFinal))}catch(e){throw new s("Failed to fetch presta\xe7\xf5es for credit ".concat(t),e)}}async createPrestacaoContas(t){try{let e=(0,r.KR)(o.O,"prestacoesContas"),a=(0,r.VC)(e),s=a.key,i={...t,id:s};return await (0,r.hZ)(a,i),s}catch(t){throw new s("Failed to create presta\xe7\xe3o de contas",t)}}async updatePrestacaoContas(t,e){try{let a=(0,r.KR)(o.O,"prestacoesContas/".concat(t));if(await (0,r.yo)(a,e),"Entregue"===e.status){let e=await (0,r.Jt)(a);if(e.exists()){let a={...e.val(),id:t};await this.gerarProximaObrigacao(a)}}}catch(e){throw new s("Failed to update presta\xe7\xe3o ".concat(t),e)}}async deletePrestacaoContas(t){try{let e=(0,r.KR)(o.O,"prestacoesContas/".concat(t));await (0,r.TF)(e)}catch(e){throw new s("Failed to delete presta\xe7\xe3o ".concat(t),e)}}async gerarPrimeiraObrigacao(t,e){try{if(!await this.getCreditoById(t))throw Error("Cr\xe9dito n\xe3o encontrado");let a=this.calcularProximoPrazo(e);await this.createPrestacaoContas({creditoId:t,ano:new Date(e).getFullYear(),periodoLabel:"1\xaa Presta\xe7\xe3o (at\xe9 ".concat(this.formatarData(a),")"),prazoFinal:a,status:"Pendente",despesasVinculadas:[]})}catch(t){throw new s("Failed to generate first obligation",t)}}async gerarProximaObrigacao(t){try{if(!await this.getCreditoById(t.creditoId))return;let e=(await this.getAllPrestacoesByCredito(t.creditoId)).length+1,a=this.calcularProximoPrazo(t.prazoFinal);await this.createPrestacaoContas({creditoId:t.creditoId,ano:new Date(a).getFullYear(),periodoLabel:"".concat(e,"\xaa Presta\xe7\xe3o (at\xe9 ").concat(this.formatarData(a),")"),prazoFinal:a,status:"Pendente",despesasVinculadas:[]})}catch(t){throw new s("Failed to generate next obligation",t)}}calcularProximoPrazo(t){let e=new Date(t);return e.setMonth(e.getMonth()+4),e.toISOString().split("T")[0]}formatarData(t){let[e,a,o]=t.split("-");return"".concat(o,"/").concat(a,"/").concat(e)}async searchDespesasByObjeto(t){try{let e=await this.getAllDespesas();return Object.values(e).filter(e=>e.objeto.toLowerCase().includes(t.toLowerCase()))}catch(t){throw new s("Failed to search expenses",t)}}async searchCreditosByCodigo(t){try{let e=await this.getAllCreditos();return Object.values(e).filter(e=>e.creditoCodigo.toLowerCase().includes(t.toLowerCase()))}catch(t){throw new s("Failed to search credits",t)}}async getDespesaDetailsWithCredits(t){try{let e=await this.getDespesaById(t);if(!e)return null;let a=await this.getAllCreditos(),o=e.fontesDeRecurso.map(t=>({fonte:t,credito:a[t.creditoId]})).filter(t=>t.credito);return{...e,fontesComCreditos:o}}catch(t){throw new s("Failed to get expense details",t)}}async getDespesasByCreditoId(t){try{let e=await this.getAllDespesas(),a=[];return Object.values(e).forEach(e=>{let o=e.fontesDeRecurso.find(e=>e.creditoId===t);o&&a.push({despesa:e,participacao:o})}),a}catch(t){throw new s("Failed to get expenses by credit",t)}}constructor(){}}let c=i.getInstance()},80314:(t,e,a)=>{a.d(e,{O:()=>n,j:()=>l});var o=a(23915),r=a(81115),s=a(16203),i=a(86864);let c=(0,o.Wp)({apiKey:"AIzaSyDhLLzcqgM26plgH7eL5mWms3EDeJqHpMY",authDomain:"suad-44036.firebaseapp.com",databaseURL:"https://suad-44036-default-rtdb.firebaseio.com",projectId:"suad-44036",storageBucket:"suad-44036.firebasestorage.app",messagingSenderId:"33344546339",appId:"1:33344546339:web:4de36f2ebaa4e4ea11f396",measurementId:"G-SNDT989PZE"}),n=(0,r.C3)(c),l=(0,s.xI)(c);(0,i.TT)().then(t=>{t&&(0,i.P5)(c)})}}]);