(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[908],{21309:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>g});var s=t(95155),r=t(12115),o=t(35695),l=t(69758),i=t(88482),c=t(88145),d=t(53999),n=t(84616),x=t(47924),m=t(1482),u=t(89578),p=t(54416);function h(e){let{onSubmit:a,onCancel:t,initialData:o,isEditing:l=!1}=e,[i,c]=(0,r.useState)({creditoCodigo:(null==o?void 0:o.creditoCodigo)||"",anoExercicio:(null==o?void 0:o.anoExercicio)||new Date().getFullYear(),valorGlobal:(null==o?void 0:o.valorGlobal)||0,acaoEixo:(null==o?void 0:o.acaoEixo)||"",natureza:(null==o?void 0:o.natureza)||"",saldoAtual:(null==o?void 0:o.saldoAtual)||0}),[d,n]=(0,r.useState)(!1),[x,m]=(0,r.useState)({}),u=async e=>{if(e.preventDefault(),(()=>{let e={};return i.creditoCodigo.trim()||(e.creditoCodigo="C\xf3digo do cr\xe9dito \xe9 obrigat\xf3rio"),(i.anoExercicio<2e3||i.anoExercicio>2100)&&(e.anoExercicio="Ano do exerc\xedcio deve estar entre 2000 e 2100"),i.valorGlobal<=0&&(e.valorGlobal="Valor global deve ser maior que zero"),i.acaoEixo.trim()||(e.acaoEixo="A\xe7\xe3o/Eixo \xe9 obrigat\xf3rio"),i.natureza.trim()||(e.natureza="Natureza \xe9 obrigat\xf3ria"),m(e),0===Object.keys(e).length})())try{n(!0);let e={...i,saldoAtual:l?i.saldoAtual:i.valorGlobal,despesas:(null==o?void 0:o.despesas)||{}};await a(e)}catch(e){console.error("Error submitting form:",e)}finally{n(!1)}},h=(e,a)=>{c(t=>({...t,[e]:a})),x[e]&&m(a=>({...a,[e]:""}))};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:l?"Editar Cr\xe9dito":"Novo Cr\xe9dito"}),(0,s.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)(p.A,{className:"w-5 h-5"})})]}),(0,s.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C\xf3digo do Cr\xe9dito *"}),(0,s.jsx)("input",{type:"text",value:i.creditoCodigo,onChange:e=>h("creditoCodigo",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(x.creditoCodigo?"border-red-500":"border-gray-300"),placeholder:"Ex: 2024DC00001"}),x.creditoCodigo&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:x.creditoCodigo})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ano do Exerc\xedcio *"}),(0,s.jsx)("input",{type:"number",value:i.anoExercicio,onChange:e=>h("anoExercicio",parseInt(e.target.value)),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(x.anoExercicio?"border-red-500":"border-gray-300"),min:"2000",max:"2100"}),x.anoExercicio&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:x.anoExercicio})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor Global (R$) *"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:i.valorGlobal,onChange:e=>h("valorGlobal",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(x.valorGlobal?"border-red-500":"border-gray-300"),min:"0"}),x.valorGlobal&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:x.valorGlobal})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"A\xe7\xe3o/Eixo *"}),(0,s.jsx)("input",{type:"text",value:i.acaoEixo,onChange:e=>h("acaoEixo",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(x.acaoEixo?"border-red-500":"border-gray-300"),placeholder:"Ex: VALORIZA\xc7\xc3O DOS PROFISSIONAIS DE SEGURAN\xc7A P\xdaBLICA"}),x.acaoEixo&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:x.acaoEixo})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Natureza *"}),(0,s.jsx)("input",{type:"text",value:i.natureza,onChange:e=>h("natureza",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(x.natureza?"border-red-500":"border-gray-300"),placeholder:"Ex: I-449000"}),x.natureza&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:x.natureza})]}),l&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Saldo Atual (R$)"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:i.saldoAtual,onChange:e=>h("saldoAtual",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",disabled:d,children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",disabled:d,children:d?"Salvando...":l?"Salvar Altera\xe7\xf5es":"Criar Cr\xe9dito"})]})]})]})})}function g(){let e=(0,o.useRouter)(),{creditos:a,loading:t,error:p,createCredito:g}=(0,u.$)(),[b,y]=(0,r.useState)([]),[v,j]=(0,r.useState)([]),[f,N]=(0,r.useState)(""),[w,C]=(0,r.useState)("todos"),[E,A]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=Object.values(a).map(e=>({...e,valorGasto:(0,d.Pt)(e.despesas)}));y(e),j(e)},[a]),(0,r.useEffect)(()=>{let e=b;f&&(e=e.filter(e=>e.creditoCodigo.toLowerCase().includes(f.toLowerCase())||e.acaoEixo.toLowerCase().includes(f.toLowerCase()))),"todos"!==w&&(e=e.filter(e=>e.anoExercicio.toString()===w)),j(e)},[f,w,b]);let k=[...new Set(b.map(e=>e.anoExercicio))].sort((e,a)=>a-e),S=async e=>{try{await g(e),A(!1)}catch(e){console.error("Failed to create credito:",e)}};return t?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(l.F,{}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"px-4 py-6 sm:px-0",children:(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Carregando cr\xe9ditos..."})})})})]}):p?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(l.F,{}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"px-4 py-6 sm:px-0",children:(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsxs)("div",{className:"text-red-500",children:["Erro ao carregar cr\xe9ditos: ",p]})})})})]}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(l.F,{}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Gest\xe3o de Cr\xe9ditos"}),(0,s.jsxs)("button",{onClick:()=>A(!0),className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 flex items-center gap-2",children:[(0,s.jsx)(n.A,{className:"w-4 h-4"}),"Adicionar Novo Cr\xe9dito"]})]}),(0,s.jsx)(i.Zp,{className:"mb-6",children:(0,s.jsx)(i.Wu,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(x.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Pesquisar por c\xf3digo ou a\xe7\xe3o/eixo...",className:"w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:f,onChange:e=>N(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.A,{className:"text-gray-400 w-4 h-4"}),(0,s.jsxs)("select",{className:"border rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:w,onChange:e=>C(e.target.value),children:[(0,s.jsx)("option",{value:"todos",children:"Todos os anos"}),k.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]})]})})}),(0,s.jsx)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ano"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C\xf3digo do Cr\xe9dito"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A\xe7\xe3o / Eixo"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Global"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Gasto"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Saldo Atual"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map(a=>{let t=(a.saldoAtual/a.valorGlobal*100).toFixed(0),r=parseInt(t)>50?"Dispon\xedvel":parseInt(t)>20?"Aten\xe7\xe3o":"Cr\xedtico";return(0,s.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>e.push("/creditos/".concat(a.id)),children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.anoExercicio}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.creditoCodigo}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:(0,s.jsx)("div",{className:"max-w-xs truncate",title:a.acaoEixo,children:a.acaoEixo})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,d.vv)(a.valorGlobal)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,d.vv)(a.valorGasto)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,d.vv)(a.saldoAtual)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)(c.E,{variant:"Dispon\xedvel"===r?"success":"Aten\xe7\xe3o"===r?"warning":"destructive",children:[t,"% - ",r]})})]},a.id)})})]})}),0===v.length&&!t&&(0,s.jsx)("div",{className:"bg-white shadow rounded-md p-8 text-center",children:(0,s.jsx)("div",{className:"text-gray-500",children:0===b.length?"Nenhum cr\xe9dito encontrado. Adicione o primeiro cr\xe9dito!":"Nenhum cr\xe9dito corresponde aos filtros aplicados."})})]})}),E&&(0,s.jsx)(h,{onSubmit:S,onCancel:()=>A(!1)})]})}},48819:(e,a,t)=>{Promise.resolve().then(t.bind(t,21309))}},e=>{e.O(0,[507,811,315,249,550,441,964,358],()=>e(e.s=48819)),_N_E=e.O()}]);